<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mews.weather.alter &mdash; MEWS 0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> MEWS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MEWS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>mews.weather.alter</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mews.weather.alter</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Apr 20 14:50:39 2021</span>

<span class="sd">Copyright Notice</span>
<span class="sd">=================</span>

<span class="sd">Copyright 2021 National Technology and Engineering Solutions of Sandia, LLC. </span>
<span class="sd">Under the terms of Contract DE-NA0003525, there is a non-exclusive license </span>
<span class="sd">for use of this work by or on behalf of the U.S. Government. </span>
<span class="sd">Export of this program may require a license from the </span>
<span class="sd">United States Government.</span>

<span class="sd">Please refer to the LICENSE.md file for a full description of the license</span>
<span class="sd">terms for MEWS. </span>

<span class="sd">The license for MEWS is the Modified BSD License and copyright information</span>
<span class="sd">must be replicated in any derivative works that use the source code.</span>

<span class="sd">@author: dlvilla</span>

<span class="sd">MEWS = Multi-senario Extreme Weather Simulator</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">calendar</span> <span class="kn">import</span> <span class="n">isleap</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">mews.epw</span> <span class="kn">import</span> <span class="n">epw</span>
<span class="kn">from</span> <span class="nn">mews.errors</span> <span class="kn">import</span> <span class="n">EPWMissingDataFromFile</span><span class="p">,</span> <span class="n">EPWFileReadFailure</span><span class="p">,</span> <span class="n">EPWRepeatDateError</span>
<span class="kn">from</span> <span class="nn">mews.weather.doe2weather</span> <span class="kn">import</span> <span class="n">DOE2Weather</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<div class="viewcode-block" id="Alter"><a class="viewcode-back" href="../../../mews.weather.alter.html#mews.weather.alter.Alter">[docs]</a><span class="k">class</span> <span class="nc">Alter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Alter energy plus or doe2 weather files - shorter or longer than a year permitted.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; obj = Alter(weather_file_path,</span>
<span class="sd">                    replace_year,</span>
<span class="sd">                    check_types)</span>
<span class="sd">    </span>
<span class="sd">    This is effectively the &quot;read&quot; function.</span>
<span class="sd">    </span>
<span class="sd">    If replace_year causes new coincidence with leap years, then an </span>
<span class="sd">    extra day is added (Feb 28th if repeated). If a replace_year moves</span>
<span class="sd">    from a leap year to a non-leap year, then Feb 29th is deleted if it </span>
<span class="sd">    is present.</span>
<span class="sd">    </span>
<span class="sd">    Returns the altered object.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weather_file_path : str </span>
<span class="sd">        A valid path to an energy plus weather file.</span>
<span class="sd">    replace_year : int : optional : Default = None</span>
<span class="sd">        If None:</span>
<span class="sd">            Leave the year in the energy plus file unaltered.</span>
<span class="sd">        If int: </span>
<span class="sd">            Change the year to the value for all rows.</span>
<span class="sd">    check_types : bool : optional : Default = True</span>
<span class="sd">        If True:</span>
<span class="sd">            Check types in all functions (slow but safe).</span>
<span class="sd">        If False: </span>
<span class="sd">            Do not check types (likely to get less understandable errors</span>
<span class="sd">            if something goes wrong)</span>
<span class="sd">    clear_alterations : optional: bool </span>
<span class="sd">        NOT CURRENTLY USED.</span>
<span class="sd">        Remove previous alterations from the current </span>
<span class="sd">        object. Reissuing a read command to an Alter object allows a new set</span>
<span class="sd">        of weather to recieve the same alterations a previous set recieved.            </span>
<span class="sd">    </span>
<span class="sd">    isdoe2 : optional: bool : ONLY NEEDED IF DOE2</span>
<span class="sd">        Read in a DOE2 weather file instead of an EPW and then</span>
<span class="sd">        wrangle that data into an EP format for the self.epwobj database.</span>
<span class="sd">    use_exe : optional : bool : ONLY NEEDED IF DOE2</span>
<span class="sd">        etermine whether to use BIN2TXT and TXT2BIN</span>
<span class="sd">        executables (True) or native Python to read BIN files.</span>
<span class="sd">    doe2_bin2txt_path : str : optional : ONLY NEEDED IF DOE2</span>
<span class="sd">        A valid path to an executable</span>
<span class="sd">        that converts a DOE2 filename.BIN weather file to an ASCII text file. </span>
<span class="sd">        The executable is assumed to be named BIN2TXT.EXE and comes with</span>
<span class="sd">        any distribution of DOE2 which can be obtained by forming a license</span>
<span class="sd">        agreement with James Hirsch and Associates (www.doe2.com). A folder</span>
<span class="sd">        in mews &quot;third_party_software&quot; can be used to put the filename.EXE</span>
<span class="sd">    doe2_start_datetime : datetime : optional : ONLY NEEDED IF DOE2</span>
<span class="sd">    Input the start time for the weather file.</span>
<span class="sd">    doe2_hour_in_file : optional : ONLY NEEDED IF DOE2</span>
<span class="sd">        Must be 8760 or 8784 for leap years.</span>
<span class="sd">    doe2_timezone : str : optional : ONLY NEEDED IF DOE2</span>
<span class="sd">        Name of time zone applicable to the doe2 file.</span>
<span class="sd">    doe2_dst : optional : ONLY NEEDED IF DOE2</span>
<span class="sd">        List/tuple with 2 entries that are datetimes with begin and </span>
<span class="sd">        end times for day light savings time.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    None</span>
<span class="sd">   </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">weather_file_path</span><span class="p">,</span><span class="n">replace_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">check_types</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">isdoe2</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">use_exe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">doe2_bin2txt_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;../third_party_software/BIN2TXT.EXE&quot;</span><span class="p">,</span>
                 <span class="n">doe2_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">doe2_tz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">doe2_hour_in_file</span><span class="o">=</span><span class="mi">8760</span><span class="p">,</span><span class="n">doe2_dst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        

        <span class="n">obj</span> <span class="o">=</span> <span class="n">DOE2Weather</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df2bin</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">df2bin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin2df</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">bin2df</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">,</span><span class="n">replace_year</span><span class="p">,</span><span class="n">check_types</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">isdoe2</span><span class="p">,</span><span class="n">use_exe</span><span class="p">,</span>
                  <span class="n">doe2_bin2txt_path</span><span class="p">,</span><span class="n">doe2_start_datetime</span><span class="p">,</span><span class="n">doe2_tz</span><span class="p">,</span>
                  <span class="n">doe2_hour_in_file</span><span class="p">,</span><span class="n">doe2_dst</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_leap_year_replacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">isdoe2</span><span class="p">):</span>
            <span class="n">Feb28</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="p">)]</span>
            <span class="n">Mar1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="p">)]</span>
            <span class="n">Feb29</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">29</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">year</span><span class="p">)]</span>
            <span class="n">hasFeb29</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Feb29</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">hasMar1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mar1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">hasFeb28</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Feb28</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            
            
            <span class="k">if</span> <span class="n">isleap</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">hasFeb29</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hasMar1</span> <span class="ow">and</span> <span class="n">hasFeb28</span><span class="p">):</span>
                <span class="c1"># add Feb29 by replicating Feb28th</span>
                <span class="n">indFeb28</span> <span class="o">=</span> <span class="n">Feb28</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">sdict</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="n">Feb28</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">col</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indFeb28</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">indFeb28</span><span class="o">+</span><span class="mi">25</span><span class="p">)</span>
                    <span class="n">sdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>

                <span class="n">Feb29</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sdict</span><span class="p">)</span>
                <span class="n">Feb29</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">29</span>
                
                <span class="n">sdict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indFeb28</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">col</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indFeb28</span><span class="o">+</span><span class="mi">25</span><span class="p">,</span>
                                          <span class="n">indFeb28</span><span class="o">+</span><span class="mi">25</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">indFeb28</span><span class="p">))</span>
                    <span class="n">sdict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
                    
                <span class="n">restOfYear</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sdict</span><span class="p">)</span>
                <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">indFeb28</span><span class="p">],</span><span class="n">Feb29</span><span class="p">,</span><span class="n">restOfYear</span><span class="p">])</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">isleap</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hasFeb29</span><span class="p">:</span>
                <span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">Feb29</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_new</span> <span class="o">=</span> <span class="n">df</span>
            
            <span class="k">if</span> <span class="n">isdoe2</span><span class="p">:</span>
                <span class="c1"># keep custom attributes like &quot;headers&quot; that were added elsewhere</span>
                <span class="n">df_new</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">headers</span>
            
            
              
            <span class="k">return</span> <span class="n">df_new</span>

                
        
    <span class="k">def</span> <span class="nf">_init_check_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">replace_year</span><span class="p">,</span><span class="n">check_types</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_types</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;check_types&#39; input must be a boolean!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_types</span><span class="p">:</span>       
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">replace_year</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">replace_year</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">positive_message</span> <span class="o">=</span> <span class="s2">&quot;&#39;replace_year&#39; must be positive&quot;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">positive_message</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">replace_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;replace_year&#39; must be a positive integer or None&quot;</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wfp_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">alt_str</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;alterations&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">alt_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;wfp&#39;</span><span class="p">):</span>
            <span class="n">wfp_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wfp</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;mews.weather.alter.Alter: </span><span class="se">\n\n</span><span class="s2">Weather for: </span><span class="se">\n\n</span><span class="s2">&#39;</span><span class="si">{0}</span><span class="s2">&#39;</span><span class="se">\n\n</span><span class="s2">with&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wfp_str</span><span class="p">)</span>
                <span class="o">+</span><span class="s2">&quot; alterations:</span><span class="se">\n\n</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alt_str</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">_get_date_ind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">month</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">hour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query for year, month, day, hour. If an input is not provided</span>
<span class="sd">                 query for any value of that entry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span>
        
        <span class="n">all_true</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yr_comparison</span> <span class="o">=</span> <span class="n">all_true</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yr_comparison</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span>
        
        <span class="k">if</span> <span class="n">month</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mo_comparison</span> <span class="o">=</span> <span class="n">all_true</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mo_comparison</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span>
            
        <span class="k">if</span> <span class="n">day</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">day_comparison</span> <span class="o">=</span> <span class="n">all_true</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">day_comparison</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">day</span>
        
        <span class="k">if</span> <span class="n">hour</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hr_comparison</span> <span class="o">=</span> <span class="n">all_true</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hr_comparison</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Hour&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hour</span>
            
        
        <span class="n">ind_list</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">yr_comparison</span> <span class="o">&amp;</span> <span class="n">mo_comparison</span> <span class="o">&amp;</span> <span class="n">day_comparison</span> 
                 <span class="o">&amp;</span> <span class="n">hr_comparison</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        
        <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ind_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ind_list</span><span class="p">[:</span><span class="n">num</span><span class="p">]</span>
        
        
<div class="viewcode-block" id="Alter.add_alteration"><a class="viewcode-back" href="../../../mews.weather.alter.html#mews.weather.alter.Alter.add_alteration">[docs]</a>    <span class="k">def</span> <span class="nf">add_alteration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">year</span><span class="p">,</span>
                      <span class="n">day</span><span class="p">,</span>
                      <span class="n">month</span><span class="p">,</span>
                      <span class="n">hour</span><span class="p">,</span>
                      <span class="n">duration</span><span class="p">,</span>
                      <span class="n">peak_delta</span><span class="p">,</span>
                      <span class="n">shape_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                      <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Dry Bulb Temperature&#39;</span><span class="p">,</span>
                      <span class="n">alteration_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">averaging_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add_alteration(year, day, month, hour, duration, peak_delta, shape_func, column)</span>
<span class="sd">        </span>
<span class="sd">        Alter weather file by adding a shape function and delta to one weather variable.</span>
<span class="sd">        </span>
<span class="sd">        Internal epwobj is altered use &quot;write&quot; to write the result.</span>
<span class="sd">            </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int </span>
<span class="sd">            Year of start date.</span>
<span class="sd">        day : int </span>
<span class="sd">            Day of month on which the heat wave starts.     </span>
<span class="sd">        month : int </span>
<span class="sd">            Month of year on which the heat wave starts.</span>
<span class="sd">        hour : int </span>
<span class="sd">            Hour of day on which the heat wave starts (1-24).</span>
<span class="sd">        Duration : int </span>
<span class="sd">            Number of hours that the heat wave lasts. if = -1</span>
<span class="sd">            then the change is applied to the end of the weather file.</span>
<span class="sd">        peak_delta : float </span>
<span class="sd">            Peak value change from original weather at &quot;shape_func&quot; maximum.</span>
<span class="sd">        shape_func : function|list|tuple|np.array </span>
<span class="sd">            A function or array whose range interval [0,1] will be mapped to </span>
<span class="sd">            [0,duration] in hours. The function will be normalized to have a peak </span>
<span class="sd">            of 1 for its peak value over [0,1]. For example, a sine function could </span>
<span class="sd">            be lambda x: sin(pi*x). This shape is applied in adding the heat wave.</span>
<span class="sd">            from the start time to duration_hours later. If the input is an</span>
<span class="sd">            array, it must have &#39;duration&#39; number of entries.</span>
<span class="sd">        column : str : optional : Default = &#39;Dry Bulb Temperature&#39;</span>
<span class="sd">            Must be an entry in the column names of the energy plus weather</span>
<span class="sd">            file.</span>
<span class="sd">        alteration_name : any type that can be a key for dict : optional : Default = None</span>
<span class="sd">                If None:</span>
<span class="sd">                    Name is &quot;Alteration X&quot; where X is the current</span>
<span class="sd">                    number of alterations + 1.</span>
<span class="sd">                If any other type: </span>
<span class="sd">                    Must not be a repeat of previously added alterations.</span>
<span class="sd">        averaging_steps : int : optional : Default = 1</span>
<span class="sd">             The number of steps to average the weather signal over when</span>
<span class="sd">             adding the heat wave. For example, if heat wave statistics</span>
<span class="sd">             come from daily data, then additions need to be made w/r to</span>
<span class="sd">             the daily average and this should be 24.</span>
<span class="sd">                </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span>
             
        
        <span class="c1"># special handling</span>
        <span class="k">if</span> <span class="n">alteration_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_alterations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="p">)</span>
            <span class="n">alteration_name</span> <span class="o">=</span> <span class="s2">&quot;Alteration </span><span class="si">{0:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_alterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">duration</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_date_ind</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="c1">## TYPE CHECKING</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_types</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;hour must be in 0 .. 23&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">duration</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;duration&#39; input must be positive and less than a year (in hours)&quot;</span><span class="p">)</span>
                
            <span class="n">correct_type_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape_func</span><span class="p">,(</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape_func</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="n">shape_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape_func</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape_func</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape_func</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="n">duration</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If the shape_func is provided as a &quot;</span>
                                         <span class="o">+</span><span class="s2">&quot;list, it must have length of the&quot;</span>
                                         <span class="o">+</span><span class="s2">&quot; &#39;duration&#39; input&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">correct_type_found</span> <span class="o">=</span> <span class="kc">False</span>
                    
            <span class="k">if</span> <span class="ow">not</span> <span class="n">correct_type_found</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The shape_func must be of type &#39;function&#39;,&#39;list&#39;, or &#39;numpy.ndarray&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;column&#39; input must be within the list:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">alteration_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;alteration_name&#39; </span><span class="si">{}</span><span class="s2"> is already taken!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alteration_name</span><span class="p">))</span>
        <span class="c1"># END TYPE CHECKING</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base1</span><span class="p">:</span>
            <span class="n">hourin</span> <span class="o">=</span> <span class="n">hour</span> <span class="o">+</span> <span class="mi">1</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hourin</span> <span class="o">=</span> <span class="n">hour</span>
        <span class="n">bind_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_date_ind</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hourin</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bind_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EPWRepeatDateError</span><span class="p">(</span><span class="s2">&quot;The date: </span><span class="si">{0}</span><span class="s2"> has a repeat entry!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">bind_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The requested alteration dates are outside the&quot;</span><span class="o">+</span>
                            <span class="s2">&quot; range of weather data in the current data!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bind</span> <span class="o">=</span> <span class="n">bind_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        
        <span class="n">eind</span> <span class="o">=</span> <span class="n">bind</span> <span class="o">+</span> <span class="n">duration</span>
        
        <span class="k">if</span> <span class="n">eind</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># remember eind is not included in the range.</span>
            <span class="k">raise</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">OutOfBoundsTimedelta</span><span class="p">(</span><span class="s2">&quot;The specified start time and&quot;</span>
                                                 <span class="o">+</span><span class="s2">&quot;duration exceed the bounds&quot;</span>
                                                 <span class="o">+</span><span class="s2">&quot;of the weather file&#39;s data!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape_func</span><span class="p">,</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">):</span>
            <span class="n">func_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">shape_func</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">duration</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func_values</span> <span class="o">=</span> <span class="n">shape_func</span>
        <span class="n">extremum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">func_values</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span><span class="nb">abs</span><span class="p">(</span><span class="n">func_values</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">extremum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s2">&quot;The shape_func input has an extremum of&quot;</span>
                                    <span class="o">+</span><span class="s2">&quot; zero. This can occur for very short&quot;</span>
                                    <span class="o">+</span><span class="s2">&quot; alterations where the shape function&quot;</span>
                                    <span class="o">+</span><span class="s2">&quot; begins and ends with zero or by&quot;</span>
                                    <span class="o">+</span><span class="s2">&quot; passing all zeros to a shape function.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">normalized_func_values</span> <span class="o">=</span> <span class="n">peak_delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">func_values</span><span class="p">)</span> <span class="o">/</span> <span class="n">extremum</span>
        
        <span class="n">addseg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">normalized_func_values</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">bind</span><span class="p">,</span><span class="n">eind</span><span class="p">),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">column</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">averaging_steps</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1">#TODO - this needs to be moved elsewhere. You have a lot of work</span>
            <span class="c1"># to do to add daily average based heat waves correctly.</span>
            <span class="n">df_avg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">averaging_steps</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="c1"># assure first steps have numeric values</span>
            <span class="n">df_avg</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">averaging_steps</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">averaging_steps</span><span class="p">]</span>
            
            <span class="n">df_diff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_avg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">addseg</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># cold snap</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="p">((</span><span class="n">addseg</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">df_diff</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="n">addseg</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># heat wave</span>
                
                <span class="k">if</span> <span class="n">addseg</span><span class="o">.</span><span class="n">max</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scale</span> <span class="o">=</span> <span class="p">((</span><span class="n">addseg</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df_diff</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">/</span><span class="n">addseg</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">addsegmod</span> <span class="o">=</span> <span class="n">addseg</span> <span class="o">*</span> <span class="n">scale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">addsegmod</span> <span class="o">=</span> <span class="n">addseg</span> <span class="o">*</span> <span class="mf">0.0</span>
            
           
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">addsegmod</span> <span class="o">=</span> <span class="n">addseg</span>
        
        <span class="c1">#df_org = deepcopy(df.loc[bind:eind-1,column])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="p">]</span> <span class="o">+</span> <span class="n">addsegmod</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="p">[</span><span class="n">alteration_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">addseg</span></div>
        
<div class="viewcode-block" id="Alter.read"><a class="viewcode-back" href="../../../mews.weather.alter.html#mews.weather.alter.Alter.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">weather_file_path</span><span class="p">,</span><span class="n">replace_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">check_types</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">clear_alterations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">isdoe2</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">use_exe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">doe2_bin2txt_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;../third_party_software/BIN2TXT.EXE&quot;</span><span class="p">,</span>
             <span class="n">doe2_start_datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">doe2_tz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">doe2_hour_in_file</span><span class="o">=</span><span class="mi">8760</span><span class="p">,</span><span class="n">doe2_dst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads an new Energy Plus Weather (epw) file (or doe2 filename.bin) while optionally </span>
<span class="sd">        keeping previously added alterations in obj.alterations.</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; obj.read(weather_file_path,</span>
<span class="sd">                     replace_year=None,</span>
<span class="sd">                     check_types=True,</span>
<span class="sd">                     clear_alterations=False,</span>
<span class="sd">                     isdoe2=False,</span>
<span class="sd">                     use_exe=False,</span>
<span class="sd">                     doe2_bin2txt_path=r&quot;../third_party_software/BIN2TXT.EXE&quot;,</span>
<span class="sd">                     doe2_start_datetime=None,</span>
<span class="sd">                     doe2_tz=None,</span>
<span class="sd">                     doe2_hour_in_file=8760,</span>
<span class="sd">                     doe2_dst=None)</span>
<span class="sd">        </span>
<span class="sd">        The input has three valid modes:</span>
<span class="sd">            Energy Plus: only input weather_file_path and optionally:</span>
<span class="sd">                replace_year, check_types, and clear_alterations</span>
<span class="sd">            DOE2 native python: All Energy Plus AND: isdoe2=True:</span>
<span class="sd">                use_exe=False (default) all other inputs are optional:</span>
<span class="sd">            DOE2 using exe: All inputs (even optional ones) are REQUIRED</span>
<span class="sd">                except doe2_bin2txt_path, replace_year, check_types, and</span>
<span class="sd">                clear_alterations remain optional.</span>
<span class="sd">                </span>
<span class="sd">        Once you have used one mode, there is no crossing over to another mode</span>
<span class="sd">        </span>
<span class="sd">        Warning: </span>
<span class="sd">            This function resets the entire object and is equivalent </span>
<span class="sd">            to creating a new object except that the previously entered </span>
<span class="sd">            alterations are left intact. This allows for these altertions</span>
<span class="sd">            to be applied in proportionately the same positions for a new</span>
<span class="sd">            weather history.</span>
<span class="sd">                </span>
<span class="sd">        If replace_year causes new coincidence with leap years, then an </span>
<span class="sd">        extra day is added (Feb 28th if repeated). If a replace_year moves</span>
<span class="sd">        from a leap year to a non-leap year, then Feb 29th is deleted if it </span>
<span class="sd">        is present.</span>
<span class="sd">        </span>
<span class="sd">        obj.epwobj has a new dataset afterwards.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weather_file_path : str </span>
<span class="sd">            Avalid path to an energy plus weather file</span>
<span class="sd">            or, if isdoe2=True, then to a DOE2 bin weather file. Many additioanl</span>
<span class="sd">            inputs are needed for the doe2 option.</span>
<span class="sd">        replace_year : int : optional : Default = None : REQUIRED IF isdoe2=True</span>
<span class="sd">            If None:</span>
<span class="sd">                Leave the year in the energy plus file unaltered.</span>
<span class="sd">            If an int:</span>
<span class="sd">                Change the year to the value for all rows.</span>
<span class="sd">            If a tup:</span>
<span class="sd">                First entry is the begin year and second is the hour</span>
<span class="sd">                at which to change to the next year.</span>
<span class="sd">                </span>
<span class="sd">            This is useful to give TMY or other multi-year compilations a single</span>
<span class="sd">            year within a scenario history. </span>
<span class="sd">        check_types : bool : optional : Default = True</span>
<span class="sd">            If True: </span>
<span class="sd">                Check types in all functions (slower but safer).</span>
<span class="sd">            If False:</span>
<span class="sd">                Do not check types (likely to get less understandable errors</span>
<span class="sd">                if something goes wrong).</span>
<span class="sd">        clear_alterations : bool : optional : Default = False</span>
<span class="sd">            Remove previous alterations from the current </span>
<span class="sd">            object. Reissuing a read command to an Alter object allows a new set</span>
<span class="sd">            of weather to recieve the same alterations a previous set recieved.</span>
<span class="sd">        isdoe2 : bool : optional </span>
<span class="sd">            Read in a DOE2 weather file instead of an EPW and then</span>
<span class="sd">            wrangle that data into an EP format for the self.epwobj database.</span>
<span class="sd">        use_exe : bool : optional</span>
<span class="sd">            If True: </span>
<span class="sd">                Use BIN2TXT.EXE to read DOE-2 BIN file.</span>
<span class="sd">            If False:</span>
<span class="sd">                Use Python to read DOE-2 BIN (PREFERRED).</span>
<span class="sd">        doe2_bin2txt_path : str : optional : </span>
<span class="sd">            A valid path to an executable</span>
<span class="sd">            that converts a DOE2 filename.BIN weather file to an ASCII text file. </span>
<span class="sd">            The executable is assumed to be named BIN2TXT.EXE and comes with</span>
<span class="sd">            any distribution of DOE2 which can be obtained by forming a license</span>
<span class="sd">            agreement with James Hirsch and Associates (www.doe2.com). A folder</span>
<span class="sd">            in mews &quot;third_party_software&quot; can be used to put the filename.EXE.</span>
<span class="sd">        doe2_start_datetime : datetime : optional </span>
<span class="sd">            Input the start time for the weather file. If not entered, then the </span>
<span class="sd">            value in the BIN file is used. </span>
<span class="sd">        doe2_hour_in_file : optional : REQUIRED IF isdoe2=True</span>
<span class="sd">            Must be 8760 or 8784 for leap years. This allows a non-leap year to </span>
<span class="sd">            be forced into a leap year for consistency. Feb28th is just repeated </span>
<span class="sd">            for such cases.</span>
<span class="sd">        doe2_timezone : str: optional : REQUIRED IF isdoe2=True</span>
<span class="sd">            Name of time zone applicable to the doe2 file.</span>
<span class="sd">        doe2_dst : optional : REQUIRED IF isdoe2=True</span>
<span class="sd">            List/tuple with 2 entries that are datetimes with begin and end </span>
<span class="sd">            times for day light savings time.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">epwobj</span> <span class="o">=</span> <span class="n">epw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span> <span class="o">=</span> <span class="n">epwobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isdoe2</span> <span class="o">=</span> <span class="n">isdoe2</span>
        
        <span class="k">if</span> <span class="n">isdoe2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">doe2_bin2txt_path</span> <span class="o">==</span> <span class="sa">r</span><span class="s2">&quot;../third_party_software/BIN2TXT.EXE&quot;</span><span class="p">:</span>
                <span class="n">doe2_bin2txt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span><span class="n">doe2_bin2txt_path</span><span class="p">)</span>
            
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_doe2_check_types</span><span class="p">(</span><span class="n">check_types</span><span class="p">,</span><span class="n">weather_file_path</span><span class="p">,</span><span class="n">doe2_start_datetime</span><span class="p">,</span> <span class="n">doe2_hour_in_file</span><span class="p">,</span>
                        <span class="n">doe2_bin2txt_path</span><span class="p">,</span><span class="n">doe2_tz</span><span class="p">,</span><span class="n">doe2_dst</span><span class="p">,</span><span class="n">use_exe</span><span class="p">)</span>
            
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin2df</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">,</span><span class="n">doe2_start_datetime</span><span class="p">,</span> <span class="n">doe2_hour_in_file</span><span class="p">,</span>
                        <span class="n">doe2_bin2txt_path</span><span class="p">,</span><span class="n">doe2_tz</span><span class="p">,</span><span class="n">doe2_dst</span><span class="p">,</span><span class="n">use_exe</span><span class="p">)</span>
            
            <span class="c1"># add Year column which is expected by the routine</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">replace_year</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;MONTH (1-12)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DAY OF MONTH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;HOUR OF DAY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>            
            <span class="c1"># this must be done now as well as later to keep the code </span>
            <span class="c1"># consistent.</span>
            <span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">epwobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">EPWFileReadFailure</span><span class="p">(</span><span class="s2">&quot;The file &#39;</span><span class="si">{0}</span><span class="s2">&#39; was not read successfully &quot;</span>
                                         <span class="o">+</span><span class="s2">&quot;by the epw package it is corrupt or &quot;</span>
                                         <span class="o">+</span><span class="s2">&quot;the wrong format!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">fileerror</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">fileerror</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">EPWFileReadFailure</span><span class="p">(</span><span class="s2">&quot;The file &#39;</span><span class="si">{0}</span><span class="s2">&#39; was not read successfully &quot;</span>
                                         <span class="o">+</span><span class="s2">&quot;by the epw package for an unknown &quot;</span>
                                         <span class="o">+</span><span class="s2">&quot;reason!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">))</span>        
            <span class="n">df</span> <span class="o">=</span> <span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span>
        
        
        <span class="c1"># verify no NaN&#39;s</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">EPWMissingDataFromFile</span><span class="p">(</span><span class="s2">&quot;NaN&#39;s are present after reading the &quot;</span>
                                         <span class="o">+</span><span class="s2">&quot;weather file. Only fully populated &quot;</span>
                                         <span class="o">+</span><span class="s2">&quot;data sets are allowed!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_check_inputs</span><span class="p">(</span><span class="n">replace_year</span><span class="p">,</span> <span class="n">check_types</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replace_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Prepare for leap year alterations</span>
            <span class="n">new_year_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_date_ind</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">hour</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_year_ind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_year</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leap_year_replacements</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">replace_year</span><span class="p">,</span> <span class="n">isdoe2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ADD A START POINT FOR THE REPLACE YEAR IF THE FILE DOES NOT BEGIN WITH </span>
                <span class="c1"># JAN 1ST</span>
                <span class="k">if</span> <span class="n">new_year_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">new_year_ind</span> <span class="o">=</span> <span class="n">new_year_ind</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># loop over years.    </span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_year_ind</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_year_ind</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">:</span><span class="n">new_year_ind</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_year</span> <span class="o">+</span> <span class="n">idx</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">:,</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace_year</span> <span class="o">+</span> <span class="n">idx</span>
                
                <span class="c1"># This has to be done separately or the new_year_ind will be </span>
                <span class="c1"># knocked out of place.</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_year_ind</span><span class="p">):</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leap_year_replacements</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">replace_year</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span> <span class="n">isdoe2</span><span class="p">)</span>
        
        <span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">epwobj</span><span class="o">.</span><span class="n">original_dataframe</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_types</span> <span class="o">=</span> <span class="n">check_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfp</span> <span class="o">=</span> <span class="n">weather_file_path</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;alterations&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">clear_alterations</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;alterations&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alterations</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># provides a registry of alterations </span>
            <span class="c1">#TODO -bring WNTR registry class into this tool.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">alteration</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">alteration</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">common_ind</span> <span class="o">=</span> <span class="n">alteration</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_ind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;None of the alteration &#39;</span><span class="si">{0}</span><span class="s2">&#39; intersects&quot;</span> 
                                   <span class="o">+</span><span class="s2">&quot; with the newly read-in epw file!&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_ind</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alteration</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                            <span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;Only some of the alteration &#39;</span><span class="si">{0}</span><span class="s2">&#39; intersects&quot;</span>
                                      <span class="o">+</span> <span class="s2">&quot;with the newly read-in epw file!&quot;</span><span class="p">)</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_ind</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_ind</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">+</span> 
                                                  <span class="n">alteration</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_ind</span><span class="p">,</span><span class="n">col</span><span class="p">])</span>
        <span class="n">first_hour_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">first_hour_val</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">first_hour_val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base1</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">first_hour_val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># in the rare case that a file does not even have 24 hours assume</span>
            <span class="c1"># that it is base 1 (i.e. 1..24 rather than 0..23)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base1</span> <span class="o">=</span> <span class="kc">True</span></div>
            
    <span class="k">def</span> <span class="nf">_check_string_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">string_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;The path &quot;</span><span class="o">+</span><span class="n">string_path</span><span class="o">+</span> 
                                        <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The input &#39;weather_file_path&#39; must be a string!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_doe2_check_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">check_types</span><span class="p">,</span><span class="n">weather_file_path</span><span class="p">,</span><span class="n">doe2_start_datetime</span><span class="p">,</span> 
                          <span class="n">doe2_hour_in_file</span><span class="p">,</span><span class="n">doe2_bin2txt_path</span><span class="p">,</span>
                          <span class="n">doe2_tz</span><span class="p">,</span><span class="n">doe2_dst</span><span class="p">,</span><span class="n">use_exe</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">check_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_string_path</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">weather_file_path</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;The path &quot;</span><span class="o">+</span><span class="n">weather_file_path</span><span class="o">+</span> 
                                            <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The input &#39;weather_file_path&#39; must be a string!&quot;</span><span class="p">)</span>
            
            
            <span class="k">if</span> <span class="n">use_exe</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_string_path</span><span class="p">(</span><span class="n">doe2_bin2txt_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doe2_start_datetime</span><span class="p">,</span><span class="n">datetime</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The input &#39;doe2_start_datetime&#39; must be a datetime object!&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">doe2_hour_in_file</span> <span class="o">!=</span> <span class="mi">8760</span> <span class="ow">and</span> <span class="n">doe2_hour_in_file</span> <span class="o">!=</span> <span class="mi">8784</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input &#39;doe2_hour_in_file&#39; must be an &quot;</span><span class="o">+</span>
                                     <span class="s2">&quot;integer of value 8760 for normal years or&quot;</span><span class="o">+</span>
                                     <span class="s2">&quot; 8784 for leap years&quot;</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doe2_tz</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The input &#39;doe2_tz&#39; must be a string!&quot;</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doe2_dst</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The input &#39;doe2_dst&#39; must be a list or tuple of 2-elements&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doe2_dst</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input &#39;doe2_dst&#39; must have 2-elements&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doe2_dst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">datetime</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doe2_dst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">datetime</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The input &#39;doe2_dst&#39; must have 2-elements that are datetime objects!&quot;</span><span class="p">)</span>
            
            
<div class="viewcode-block" id="Alter.remove_alteration"><a class="viewcode-back" href="../../../mews.weather.alter.html#mews.weather.alter.Alter.remove_alteration">[docs]</a>    <span class="k">def</span> <span class="nf">remove_alteration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alteration_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an alteration that has already been added.</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; obj.remove_alteration(alteration_name)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alteration_name : str</span>
<span class="sd">            A name that must exist in the obj.alterations already added.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alteration_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span>
            <span class="n">addseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">alteration_name</span><span class="p">)</span> <span class="c1"># pop returns and removes</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">addseg</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">bind</span> <span class="o">=</span> <span class="n">addseg</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">eind</span> <span class="o">=</span> <span class="n">addseg</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="p">,</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="p">,</span><span class="n">column</span><span class="p">]</span> <span class="o">-</span> <span class="n">addseg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">bind</span><span class="p">:</span><span class="n">eind</span><span class="p">,</span><span class="n">column</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The alteration </span><span class="si">{0}</span><span class="s2"> does not exist. Valid&quot;</span>
                             <span class="o">+</span><span class="s2">&quot; alterations names are:</span><span class="se">\n\n</span><span class="si">{1}</span><span class="s2">&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alteration_name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alterations</span><span class="p">)))</span></div>
        
<div class="viewcode-block" id="Alter.reindex_2_datetime"><a class="viewcode-back" href="../../../mews.weather.alter.html#mews.weather.alter.Alter.reindex_2_datetime">[docs]</a>    <span class="k">def</span> <span class="nf">reindex_2_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tzname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">original</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; obj.reindex_2_datetime(tzname=None)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tzname : str : optional : Default = None</span>
<span class="sd">            A valid time zone name. When None, the data is kept in the native</span>
<span class="sd">            time zone.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df_out</span>
<span class="sd">            Dataframe with a DatetimeIndex index and weather data.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">original</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">original_dataframe</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span>
        
        <span class="n">begin_end_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                                   <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">df_out</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">datind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">begin_end_times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">begin_end_times</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">tz</span><span class="o">=</span><span class="n">tzname</span><span class="p">)</span>
        <span class="n">df_diff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_out</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">datind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># a lost hour from daylight savings time must be removed from the end</span>
            <span class="c1">#TODO - actually find dates of Daylight savings time and verify this is always</span>
            <span class="c1">#       what is happening so that this does not create a way for other bugs</span>
            <span class="c1">#       to pass through.</span>
            <span class="n">df_out</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_out</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     
        <span class="k">elif</span> <span class="n">df_diff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;There is a datetime error that is unknown!&quot;</span><span class="p">)</span>

        <span class="n">df_out</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">datind</span>

        <span class="k">return</span> <span class="n">df_out</span></div>
    
    <span class="k">def</span> <span class="nf">_write_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">out_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">create_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">out_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wfp</span> <span class="o">+</span> <span class="s2">&quot;_Altered&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">base_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
        <span class="c1"># deal with folder/file existence issues</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;The file &#39;</span><span class="si">{0}</span><span class="s2">&#39; already &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span>
                                          <span class="o">+</span><span class="s2">&quot;exists!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">create_dir</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="s2">&quot;The folder &#39;</span><span class="si">{0}</span><span class="s2">&#39; does not&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
                                         <span class="o">+</span><span class="s2">&quot; exist&quot;</span><span class="p">)</span>
    
<div class="viewcode-block" id="Alter.write"><a class="viewcode-back" href="../../../mews.weather.alter.html#mews.weather.alter.Alter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">out_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">create_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">use_exe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">txt2bin_exepath</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;../third_party_software/TXT2BIN.EXE&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes to an Energy Plus Weather file with alterations.</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; obj.write(out_file_name=None,</span>
<span class="sd">                      overwrite=False,</span>
<span class="sd">                      create_dir=False,</span>
<span class="sd">                      use_exe=False,</span>
<span class="sd">                      txt2bin_exepath=r&quot;../third_party_software/TXT2BIN.EXE&quot;)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        out_file_name : str : optional : Default = None</span>
<span class="sd">            File name and path to output altered epw weather to. </span>
<span class="sd">            If None, then use the original file name with &quot;_Altered&quot; appended to it.</span>
<span class="sd">        overwrite : bool : optional : Default = False</span>
<span class="sd">            If True, overwrite an existing file otherwise throw an error if the </span>
<span class="sd">            file exists.</span>
<span class="sd">        create_dir : bool : optional : Default = False</span>
<span class="sd">            If True create a new directory, otherwise throw an error if the </span>
<span class="sd">            folder does not exsit.</span>
<span class="sd">        txt2bin_exepath : str : optional</span>
<span class="sd">            ...</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">out_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wfp</span> <span class="o">+</span> <span class="s2">&quot;_Altered&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">base_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
        <span class="c1"># deal with folder/file existence issues</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;The file &#39;</span><span class="si">{0}</span><span class="s2">&#39; already &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span>
                                          <span class="o">+</span><span class="s2">&quot;exists!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">create_dir</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="s2">&quot;The folder &#39;</span><span class="si">{0}</span><span class="s2">&#39; does not&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
                                         <span class="o">+</span><span class="s2">&quot; exist&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdoe2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">txt2bin_exepath</span><span class="o">==</span><span class="sa">r</span><span class="s2">&quot;../third_party_software/TXT2BIN.EXE&quot;</span><span class="p">:</span>
                <span class="n">txt2bin_exepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span><span class="n">txt2bin_exepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_exe</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_string_path</span><span class="p">(</span><span class="n">txt2bin_exepath</span><span class="p">)</span>
            <span class="n">start_datetime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hour_in_file</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">df2bin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">out_file_name</span><span class="p">,</span> <span class="n">use_exe</span><span class="p">,</span> <span class="n">start_datetime</span><span class="p">,</span> 
                   <span class="n">hour_in_file</span><span class="p">,</span> <span class="n">txt2bin_exepath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epwobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span></div></div>
        
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, National Technology and Engineering Solutions of Sandia, LLC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>